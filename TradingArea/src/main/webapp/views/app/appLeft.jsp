<%@ page language="java" import="java.util.*" pageEncoding="UTF-8"%><%String path = request.getContextPath();String basePath = request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";%><%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %><%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %><%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %><div id="leftArea" class="layui-side app-left">	<div class="layui-side-scroll">		<div class="zTreeDemoBackground left">			<ul id="treeLeft" class="ztree"></ul>		</div>		<div class="app-left-search">			<form class="layui-form form" action="">			<span class="app-search-str">&nbsp;&nbsp;快速检索</span>			<input type="text" id="key" name="key" lay-verify="required" placeholder="请输入商圈或者商业体名称" autocomplete="off" class="layui-input app-search-input app-search-input-spe">			<div style="height: 5px;"></div>			<span class="app-search-str">&nbsp;&nbsp;检索结果</span>			<div class="search-clear">			<a id="clearFunc" class="layui-btn layui-btn-xs layui-btn-danger"><i class="layui-icon">&#xe640;</i> 清空</a>			</div>			<div id="searchArea" class="layui-form-item search-select-item app-search-input">			</div>			</form>		</div>	</div></div><script type="text/javascript" src="<%=basePath %>layui/layui.js" charset="utf-8"></script><link rel="stylesheet" href="<%=basePath %>thirdjs/tree/css/demo.css" type="text/css"><link rel="stylesheet" href="<%=basePath %>thirdjs/tree/css/zTreeStyle/zTreeStyle.css" type="text/css"><script type="text/javascript" src="<%=basePath %>thirdjs/tree/js/jquery-1.4.4.min.js"></script><script type="text/javascript" src="<%=basePath %>thirdjs/tree/js/jquery.ztree.core.js"></script><script type="text/javascript" src="<%=basePath %>thirdjs/tree/js/jquery.ztree.excheck.js"></script><script>	// 左边搜索展示的区域高度计算	/* var leftHeight = $("#leftArea").css("height");	leftHeight = leftHeight.replace('px', '');	$("#searchArea").css("height", (leftHeight/2-30)+"px"); */	// 左侧选择的节点	var selectNodes = [];	// 右侧选择分析的图	var selectAnalysis = 1;	var loadTotalAnalysis = function() {};	var loadTrendAnalysis = function() {};	var loadCompareAnalysis = function() {};	var selectTime = 'month';	var selectTime1 = 'month';	var selectTime2 = 'month';	var selectTime3 = '${startYear}-${startMonth}';	var selectTime31 = '${endYear}-${endMonth}';	var selectContent = 'sales';	var selectContent1 = 'sales';	var selectContent2 = 'sales';	var selectContent21 = '';	var selectContent3 = 'sales';	var selectContent31 = '';			// 左侧的书节点	var zNodes = [];	var setting = {		view : {			selectedMulti : false		},		check : {			enable : true		},		data : {			simpleData : {				enable : true			}		},		callback : {			onCheck : onCheck		}	};	function onCheck(e, treeId, treeNode) {		selectNodes = [];		var zTree = $.fn.zTree.getZTreeObj("treeLeft");		var checkNodes = zTree.getCheckedNodes(true);		for (var i = 0; i < checkNodes.length; i++) {			if (checkNodes[i].id > 0) {				selectNodes.push(checkNodes[i].id);			}		}		loadAnalysisFunc();	}	function removeByValue(arr, val) {		for(var i=0; i<arr.length; i++) {			if(arr[i] == val) {				arr.splice(i, 1);				break;			}		}	}	function createTree() {		$.fn.zTree.init($("#treeLeft"), setting, zNodes);	}	var initZNodes = function(data) {		var resultArr = [];		var tradeList = data.tradeList || [];		var businessList = data.businessList || [];		// 初始化商圈的数据		var tradeParentItem = {			id : -1,			pId : 0,			name : "商圈",			open : true		};		resultArr.push(tradeParentItem);		for ( var i = 0; i < tradeList.length; i++) {			var _obj = tradeList[i];			var item = {};			item.id = _obj.id;			item.pId = -1;			item.name = _obj.tradeName;			resultArr.push(item);		}		// 初始化商业体的数据		var businessParentItem = {			id : -2,			pId : 0,			name : "商业体",			open : true		};		resultArr.push(businessParentItem);		for ( var i = 0; i < businessList.length; i++) {			var _obj = businessList[i];			var item = {};			item.id = _obj.id;			item.pId = -2;			item.name = _obj.tradeName;			resultArr.push(item);		}		zNodes = resultArr;	};	// 加载商圈和商业体的数据	var loadTradeData = function() {		$.ajax({			url : _basePath + "app/getTradeList.do",			dataType : "json",			success : function(data) {				initZNodes(data);				createTree();			}		});	};	$(document).ready(function() {		loadTradeData();	});		// 同步搜素结果	var TBFunc = function(dataId, check) {		var zTree = $.fn.zTree.getZTreeObj("treeLeft");		var checkNode = zTree.getNodeByParam("id", dataId);		if (checkNode.checked != check) {			zTree.checkNode(checkNode);		}			};	// 加载数据	var loadAnalysisFunc = function() {		if (selectAnalysis == 1) {			loadTotalAnalysis();		}		else if (selectAnalysis == 2) {			loadTrendAnalysis();		}		else if (selectAnalysis == 3) {			loadCompareAnalysis();		}	};	layui.use([ 'laypage', 'layer', 'form', 'element' ],function() {			var laypage = layui.laypage, $ = layui.jquery, form = layui					.form, element = layui.element;			// 监听提交			/* form.on('submit(formSave)', function(data) {				console.log(123);				return false;			}); */			$("#clearFunc").on("click", function() {				$("#searchArea").empty();			});			document.onkeydown = function keyDownSearch(e) {				// 兼容FF和IE和Opera    				var theEvent = e || window.event;				var code = theEvent.keyCode || theEvent.which						|| theEvent.charCode;				if (code == 13) {					loadSearchData();					return false;				}				return true;			};			// 加载检索的数据			var refreshSearchView = function(data) {				//<p><input type="checkbox" name="like[write]" title="想南校五角场"></p>				$("#searchArea").empty();				for ( var i = 0; i < data.length; i++) {					var _obj = data[i];					var searchItem = '<p><input type="checkbox" data-id="'+_obj.id+'" name="like['+_obj.tradeCode+']" title="'+_obj.tradeName+'"></p>';					$("#searchArea").append(searchItem);				}				form.render();								form.on('checkbox', function (data) {					var dataId = data.elem.getAttribute("data-id");					removeByValue(selectNodes, dataId*1);					if (data.elem.checked) {						selectNodes.push(dataId*1);					}					TBFunc(dataId, data.elem.checked);					loadAnalysisFunc();	            });							};			var loadSearchData = function() {				var keyValue = $("#key").val() || '';				if (keyValue == '') {					return;				}				$.ajax({					url : "<%=basePath%>app/search.do",					type: 'post',					data: {"key": keyValue},					dataType: "json",					success : function(data) {						if (data.code == 0) {							refreshSearchView(data.data);						}					}				});			};		});				</script>