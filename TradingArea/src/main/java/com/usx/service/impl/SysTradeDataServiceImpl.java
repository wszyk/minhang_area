package com.usx.service.impl;import java.text.ParseException;import java.util.Date;import java.util.List;import java.util.Map;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;import org.springframework.transaction.annotation.Transactional;import com.usx.dao.SysTradeDataDao;import com.usx.model.Trade;import com.usx.model.TradeData;import com.usx.service.SysTradeDataService;import com.usx.util.StringUtil;@Service@Transactionalpublic class SysTradeDataServiceImpl implements SysTradeDataService {	@Autowired	private SysTradeDataDao sysTradeDataDao;	public List<Map<String, Object>> getDataList(final int page,			final int pageSize, final Map<String, String> map) {		return sysTradeDataDao.getDataList(page, pageSize, map);	}	public int getDataCount(final Map<String, String> _map) {		return sysTradeDataDao.getDataCount(_map);	}	public void saveData(TradeData tradeData) {		sysTradeDataDao.saveData(tradeData);	}	public void editData(TradeData tradeData) {		sysTradeDataDao.editData(tradeData);	}	public TradeData getDataById(final int dataId) {		return sysTradeDataDao.getDataById(dataId);	}	public void deleteDataById(final int id) {		sysTradeDataDao.deleteDataById(id);	}	public void saveImport(List<List<Object>> list, String areaId, List<Trade> tradeList) throws ParseException {		int i = 0;		for (List<Object> object : list) {			if (i++ == 0)				continue; // 表头不读取			if (object == null || object.size() == 0)				break; // 读取到空结束			TradeData tradeData = new TradeData();			tradeData.setAreaId(Integer.parseInt(areaId));			// 名称			String tradeName = object.get(0).toString().trim();			Trade trade = getTradeIdByName(tradeList, tradeName);			if (trade == null) {				continue;			}			tradeData.setTradeId(trade.getId());			tradeData.setFlg(trade.getFlg());			tradeData.setTradeName(tradeName);			// 行业			String industry = object.get(1).toString().trim();			tradeData.setIndustry(industry);			// 月份			String dateTime = object.get(2).toString();			tradeData.setDateTime(StringUtil.parse(dateTime));			// 销售额(万元)			String sales = object.get(3).toString();			tradeData.setSales(Double.parseDouble(sales));			// 交易笔数			String salesNums = object.get(4).toString();			tradeData.setSalesNums((int)Double.parseDouble(salesNums));			// 商户数			String mids = object.get(5).toString();			tradeData.setMids((int)Double.parseDouble(mids));						// 创建时间			tradeData.setCreateTime(new Date());						// 保存			sysTradeDataDao.saveData(tradeData);		}	}		private Trade getTradeIdByName(List<Trade> tradeList, String tradeName) {		Trade result = null;		for (Trade trade : tradeList) {			if (tradeName.equals(trade.getTradeName())) {				result = trade;				break;			}		}		return result;	}		public Date getMaxDateByTradeIds(final String tradeIds) {		return sysTradeDataDao.getMaxDateByTradeIds(tradeIds);	}		public List<Map<String, Object>> loadTotalAnalysis(final String formatTime, final String selectContent, final String tradeIds, final int areaId) {		return sysTradeDataDao.loadTotalAnalysis(formatTime, selectContent, tradeIds, areaId);	}	public List<Map<String, Object>> loadTradeTotalAnalysis(final String formatTime, final String selectContent,			final String tradeIds, final int areaId) {		return sysTradeDataDao.loadTradeTotalAnalysis(formatTime, selectContent, tradeIds, areaId);	}		public List<Map<String, Object>> loadTrendAnalysis(final String formatTime, final String selectContent,			final String tradeIds, final int areaId) {		return sysTradeDataDao.loadTrendAnalysis(formatTime, selectContent, tradeIds, areaId);	}		public List<Map<String, Object>> loadCompareAnalysis(final String formatTime, final String selectContent,			final String tradeIds, final int areaId) {		return sysTradeDataDao.loadCompareAnalysis(formatTime, selectContent, tradeIds, areaId);	}		public List<Map<String, Object>> loadTradeCompareAnalysis(final String formatTime, final String selectContent,			final String tradeIds, final int areaId) {		return sysTradeDataDao.loadTradeCompareAnalysis(formatTime, selectContent, tradeIds, areaId);	}		public List<String> getAllIndustry(final int areaId) {		return sysTradeDataDao.getAllIndustry(areaId);	}		public List<Map<String, Object>> getDataByKeys(final String areaId, final String tradeId, final String industry, final String dateStart, final String dateEnd) {		return sysTradeDataDao.getDataByKeys(areaId, tradeId, industry, dateStart, dateEnd);	}}